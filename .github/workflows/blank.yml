# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the master branch
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
#   test:
#     runs-on: ubuntu-latest
    
#     steps:
#     - name: checkout
#       uses: actions/checkout@master
    
#     - name: gradle test
#       uses: OrangeLabs-moe/gradle-actions@v5.0-openjdk-11
#       with:
#         args: test
        
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: checkout
      uses: actions/checkout@master
    
#     - name: gradle jar
#       uses: OrangeLabs-moe/gradle-actions@v5.0-openjdk-11
#       with:
#         args: jar
        
    - name: Checkout tools repo
      uses: actions/checkout@v3
      with:
        repository: chigirh/com-chigirh-tools-jar
        path: tools-jar
      
    - name: Setup git repogitories
      env:
        GITHUB_IO_REPO_DEPLOY_KEY: ${{ secrets.GITHUB_IO_REPO_DEPLOY_KEY }}
      run: |
        echo "b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZWQyNTUxOQAAACBu2djOvfRAdel8jgSYn+v8oK8BSNVUcTaDqk+hhh1tywAAAJh+pZnAfqWZwAAAAAtzc2gtZWQyNTUxOQAAACBu2djOvfRAdel8jgSYn+v8oK8BSNVUcTaDqk+hhh1tywAAAEClXbPhO1BT/ZD9vjyh7tHVT0Sdvk9ARHHojhpjErIU4m7Z2M699EB16XyOBJif6/ygrwFI1VRxNoOqT6GGHW3LAAAAFWFiY2g5QERFU0tUT1AtU0s4SFBDNg==" > ~/deploy_key.pem
        chmod 600 ~/deploy_key.pem
        git config --global user.email "com-chigirh-tools-common@github.io"
        git config --global user.name "com-chigirh-tools-common"

    - name: Build pages
      run: |
        ls
        cp -f ./libs/sample.txt ./tools-jar/sample.txt

    - name: Deploy
      env:
        GIT_SSH_COMMAND: ssh -i ~/deploy_key.pem -o StrictHostKeyChecking=no -F /dev/null
      run: |
        echo "$GITHUB_IO_REPO_DEPLOY_KEY"
        cd tools-jar
        git status
        git add .
        git commit -m "Deploy 'com-chigirh-tools-common' by GitHub Actions"
        git pull origin master
        git push origin master
    
#     - name: Commit & Push changes
#       uses: actions-js/push@master
#       with:
#         github_token: ${{ secrets.SECRET_KEY }}
#         repository: chigirh/com-chigirh-tools-jar
#         branch: master

    
